tup.dorulesfile()

-- Changes here need to be reflected in the build.sh file
srcs = {}
mingwsrcs = {}

if tup.getconfig('TUP_PLATFORM') == 'linux'
then
	table.insert(srcs, 'utimensat_linux.c')
	table.insert(srcs, 'dummy.c')
end

if tup.getconfig('TUP_PLATFORM') == 'freebsd'
then
	table.insert(srcs, 'utimensat_linux.c')
	table.insert(srcs, 'dummy.c')
	table.insert(srcs, 'clearenv.c')
end

if tup.getconfig('TUP_PLATFORM') == 'macosx'
then
table.insert(srcs, 'clearenv.c')
table.insert(srcs, 'dir_mutex.c')

table.insert(srcs, 'faccessat.c')
table.insert(srcs, 'fchmodat.c')
table.insert(srcs, 'fchownat.c')
table.insert(srcs, 'fdopendir.c')
table.insert(srcs, 'fstatat.c')
table.insert(srcs, 'mkdirat.c')
table.insert(srcs, 'openat.c')
table.insert(srcs, 'readlinkat.c')
table.insert(srcs, 'renameat.c')
table.insert(srcs, 'symlinkat.c')
table.insert(srcs, 'unlinkat.c')
table.insert(srcs, 'utimensat.c')

end

if tup.getconfig('TUP_PLATFORM') == 'solaris'
then
table.insert(srcs, 'dir_mutex.c')
table.insert(srcs, 'mkdirat.c')
table.insert(srcs, 'readlinkat.c')
end
for index, file in ipairs(srcs) do bang_cc(file) end

table.insert(mingwsrcs, 'dir_mutex.c')
table.insert(mingwsrcs, 'fstatat.c')
table.insert(mingwsrcs, 'mkdirat.c')
table.insert(mingwsrcs, 'openat.c')
table.insert(mingwsrcs, 'renameat.c')
table.insert(mingwsrcs, 'unlinkat.c')
for index, file in ipairs(mingwsrcs) do bang_mingwcc(file) end
